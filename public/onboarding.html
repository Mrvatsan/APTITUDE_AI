<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Started - Aptitude Master</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <nav class="navbar">
        <div class="logo">üß† Aptitude Master</div>
    </nav>

    <main class="container">
        <div class="card" style="max-width: 600px; margin: 2rem auto;">
            <!-- Step 1: Basic Info -->
            <div id="step-1" class="step">
                <div class="text-center mb-3">
                    <h1>Welcome! Let's get started üöÄ</h1>
                    <p class="text-muted">Create your account and personalize your learning journey.</p>
                </div>

                <div class="mb-2">
                    <label class="text-muted">Choose a Username</label>
                    <input type="text" id="username" class="input" placeholder="e.g., aptitude_pro">
                </div>

                <div class="mb-2">
                    <label class="text-muted">Email (optional)</label>
                    <input type="email" id="email" class="input" placeholder="your@email.com">
                </div>

                <div class="mb-2">
                    <label class="text-muted">Password</label>
                    <input type="password" id="password" class="input" placeholder="Create a strong password">
                </div>
                <div class="mb-3">
                    <label class="text-muted mb-1">What's your goal?</label>
                    <div id="goal-options" style="display: grid; grid-template-columns: 1fr; gap: 0.75rem;">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <div class="mt-3">
                    <button class="btn btn-primary btn-lg" style="width: 100%;" onclick="nextStep(2)">
                        Continue ‚Üí
                    </button>
                </div>
            </div>
            <!-- Step 2: Milestone Selection -->
            <div id="step-2" class="step hidden">
                <div class="text-center mb-3">
                    <h2>Select Your Focus Areas üìä <span id="milestone-count"
                            style="font-size: 1.2rem; color: var(--primary);">(0/4)</span></h2>
                    <p class="text-muted">Pick up to 4 milestones you want to work on.</p>
                </div>

                <div id="milestone-options" class="mb-3">
                    <!-- Populated by JS -->
                </div>

                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-secondary" style="flex: 1;" onclick="prevStep(1)">
                        ‚Üê Back
                    </button>
                    <button class="btn btn-primary" style="flex: 2;" onclick="completeOnboarding()">
                        Complete Setup ‚úÖ
                    </button>
                </div>
            </div>
            <!-- Success -->
            <div id="step-success" class="step hidden text-center">
                <div style="font-size: 4rem; margin-bottom: 1rem;">üéâ</div>
                <h2>You're all set!</h2>
                <p class="text-muted mb-3">Welcome to Aptitude Master. You've earned your first badge!</p>

                <div class="badge badge-iron" style="font-size: 1.5rem; padding: 0.75rem 1.5rem; margin-bottom: 2rem;">
                    üõ°Ô∏è Iron Badge
                </div>

                <a href="index.html" class="btn btn-primary btn-lg">
                    Go to Dashboard ‚Üí
                </a>
            </div>
        </div>
    </main>
    <script>
        const selectedMilestones = new Set(); // Default selection empty
        const MAX_MILESTONES = 4;
        let selectedGoal = null;

        const goals = [
            { id: 'placements', name: 'Campus Placements', desc: 'Prepare for top companies (3-6 months)' },
            { id: 'bank_exam', name: 'Bank Exams', desc: 'IBPS, SBI, RBI & other banking exams' },
            { id: 'ssc', name: 'SSC / Gov Exams', desc: 'CGL, CHSL & other government roles' },
            { id: 'cat', name: 'CAT / MBA', desc: 'Entrance exams for top business schools' },
            { id: 'general', name: 'General Practice', desc: 'Improve your overall aptitude skills' }
        ];

        document.addEventListener('DOMContentLoaded', async () => {
            renderGoalOptions();

            // Load milestones for selection
            try {
                const res = await fetch('/api/milestones');
                const data = await res.json();
                renderMilestoneOptions(data.milestones);
                updateMilestoneCount();
            } catch (err) {
                console.error('Failed to load milestones', err);
            }
        });
        function renderGoalOptions() {
            const container = document.getElementById('goal-options');
            container.innerHTML = goals.map(g => `
                <div class="goal-option ${selectedGoal === g.id ? 'selected' : ''}" onclick="selectGoal('${g.id}')">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${g.name}</strong>
                            <div class="text-muted" style="font-size: 0.85rem;">${g.desc}</div>
                        </div>
                        <div class="radio-circle">
                            ${selectedGoal === g.id ? '<div class="radio-inner"></div>' : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        function selectGoal(id) {
            selectedGoal = id;
            renderGoalOptions();
        }
        function renderMilestoneOptions(milestones) {
            const container = document.getElementById('milestone-options');
            container.innerHTML = milestones.map(m => `
        <div class="milestone-option ${selectedMilestones.has(m.id) ? 'selected' : ''}" onclick="toggleMilestone(${m.id}, this)">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <strong>${m.name}</strong>
              <div class="text-muted" style="font-size: 0.875rem;">${m.topics.map(t => t.name).slice(0, 3).join(', ')}...</div>
            </div>
            <span class="check-icon">${selectedMilestones.has(m.id) ? '‚úì' : ''}</span>
          </div>
        </div>
      `).join('');
        }
        function updateMilestoneCount() {
            const count = selectedMilestones.size;
            const el = document.getElementById('milestone-count');
            el.textContent = `(${count}/${MAX_MILESTONES})`;

            if (count === MAX_MILESTONES) {
                el.style.color = 'var(--success)';
            } else {
                el.style.color = 'var(--primary)';
            }
        }
        function toggleMilestone(id, el) {
            if (selectedMilestones.has(id)) {
                selectedMilestones.delete(id);
                el.classList.remove('selected');
                el.querySelector('.check-icon').textContent = '';
            } else {
                if (selectedMilestones.size >= MAX_MILESTONES) {
                    // Shake animation or alert
                    el.style.transform = 'translateX(5px)';
                    setTimeout(() => el.style.transform = 'translateX(-5px)', 50);
                    setTimeout(() => el.style.transform = 'translateX(5px)', 100);
                    setTimeout(() => el.style.transform = 'translateX(0)', 150);
                    return; // Stop selection
                }
                selectedMilestones.add(id);
                el.classList.add('selected');
                el.querySelector('.check-icon').textContent = '‚úì';
            }
            updateMilestoneCount();
        }
